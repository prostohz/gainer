# MR Report Builder

Этот модуль отвечает за создание и обработку отчетов по торговым парам для стратегий mean reversion.

## Структура модуля

- `index.ts` - Основной файл с функциями создания отчетов
- `configs.ts` - Конфигурационные константы
- `pairScore.ts` - Функция расчета скора пригодности торговой пары
- `recalculateScores.ts` - Скрипт для пересчета скоров существующих записей

## Пересчет скоров

Если в алгоритм расчета скоров были внесены изменения, можно пересчитать скоры для всех существующих записей в базе данных.

### Запуск скрипта

```bash
# Запуск через NPM скрипт
npm run recalculate-scores

# Или напрямую через ts-node
ts-node src/server/modules/mrReportBuilder/recalculateScores.ts
```

### Что делает скрипт

1. Подключается к базе данных
2. Извлекает все записи из таблицы `mr_report_entries`
3. Для каждой записи рассчитывает скор с помощью функции `calculatePairScore`
4. Обновляет записи в базе данных с новыми значениями скоров
5. Обрабатывает записи батчами по 100 штук для оптимизации производительности

### Логирование

Скрипт выводит подробную информацию о процессе:

- Количество найденных записей
- Прогресс обработки по батчам
- Общий прогресс в процентах
- Результат выполнения

### Обработка ошибок

В случае ошибки скрипт:

- Выводит подробную информацию об ошибке
- Корректно закрывает соединение с базой данных
- Завершается с кодом ошибки 1

## Алгоритм скоринга

Скор рассчитывается на основе следующих параметров:

- **p-value коинтеграции** (вес 25%) - чем меньше, тем лучше
- **Half-Life** (вес 20%) - оптимальный диапазон 5-30 минут
- **Корреляция по ценам** (вес 20%) - в диапазоне 0.5-0.99
- **Корреляция по доходностям** (вес 15%) - в диапазоне 0.3-0.99
- **Количество пересечений** (вес 10%) - оптимально около 50
- **Волатильность спреда** (вес 10%) - умеренная волатильность предпочтительна

Результат нормализуется на шкалу от 0 до 100, где 100 - наилучшая пригодность для торговли.
